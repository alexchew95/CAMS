<!doctype html>
<html lang="en" dir="ltr">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta http-equiv="Content-Language" content="en" />
	<meta name="msapplication-TileColor" content="#2d89ef">
	<meta name="theme-color" content="#4188c9">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<link rel="icon" href="./favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
	<!-- Generated: 2018-04-06 16:27:42 +0200 -->
	<title>CAMS - Home</title>
	<script src="https://www.gstatic.com/firebasejs/7.0.0/firebase.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,500,500i,600,600i,700,700i&amp;subset=latin-ext">
	<script src="./assets/js/require.min.js"></script>

	<script>
		requirejs.config({
			baseUrl: '.'
		});

	</script>

	<link href="./assets/css/dashboard.css" rel="stylesheet" />
	<script src="./assets/js/dashboard.js"></script>
	<script src="./assets/plugins/input-mask/plugin.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

</head>
<div class="custom-loader"></div>

<body class="">
	<div class="page">
		<div class="page-main">
			<div class="header py-4">
				<div class="container" id="topbar">
					<!--Header to auto load here-->
				</div>
			</div>

			<div class="header collapse d-lg-flex p-0" id="headerMenuCollapse">
				<div class="container" id="navbar">

				</div>
			</div>

			<div class="my-3 my-md-5">
				<div class="container">
					<div class="page-header">
						<h1 class="page-title">
							Article Feedback
						</h1>
					</div>


					<fieldset class="form-fieldset" id="add_Feedback">
						<form id="add_Feedback">
							<div class="form-group">
								<label class="form-label">Title:<span class="form-required">*</span></label>
								<input type="text" id="Title_R" class="form-control" />
							</div>
							<div class="form-group">
								<label class="form-label">Abstract:<span class="form-required">*</span></label>
								<textarea id="Abstract_R" rows="5" cols="20" class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Keywords:<span class="form-required">*</span></label>
								<input type="text" id="Keywords_R" class="form-control" />
							</div>
							<div class="form-group">
								<label class="form-label">Introduction:<span class="form-required">*</span></label>
								<textarea id="Introduction_R" rows="5" cols="20" class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Literature Review:<span class="form-required">*</span></label>
								<textarea id="Literature_Review_R" rows="5" cols="20" class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Research Methodology:<span
										class="form-required">*</span></label>
								<textarea id="Research_Methodology_R" rows="5" cols="20"
									class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Conclusion:<span class="form-required">*</span></label>
								<textarea id="Conclusion_R" rows="5" cols="20" class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Contribution/Novelty:<span
										class="form-required">*</span></label>
								<input type="text" id="Contribution_R" class="form-control" />
							</div>
							<div class="form-group">
								<label class="form-label">References:<span class="form-required">*</span></label>
								<input type="text" id="References_R" class="form-control" />
							</div>
							<div class="form-group">
								<label class="form-label">Overall quality of the paper:<span
										class="form-required">*</span></label>
								<textarea id="Overall_R" rows="5" cols="20" class="form-control"></textarea>
							</div>
							<div class="form-group">
								<label class="form-label">Note to the editor:<span
										class="form-required">*</span></label>
								<input type="text" id="NoteEditor_R" class="form-control" />
							</div>

							<div class="form-group">
								<label class="form-label">Decision:<span class="form-required">*</span></label>
								<!-- <input type="text" id="Area" class="form-control" /> -->
								<select name="DecisionOfReviewer" id="Decision_R">
									<option value="Accept">Accept</option>
									<option value="Accept with minor corrections">Accept with minor corrections</option>
									<option value="Accept with major corrections">Accept with major corrections</option>
									<option value="Reject with resubmission encouraged">Reject with resubmission
										encouraged</option>
									<option value="Reject">Reject</option>
								</select>
							</div>

							<br />
							<br />
							<div class="btn-list">
								<a href="#" id="r_update" class="btn btn-success" type="submit">Save</a>
								<a href="#" id="r_submit" class="btn btn-success" type="submit">Submit</a>
								<button href='#' onclick="window.history.back()" class="btn btn-danger">Back</button>
							</div>
						</form>
					</fieldset>
				</div>

			</div>



		</div>
		<div class="footer">

		</div>
		<footer class="footer">
			<div class="container">
				<div class="row align-items-center flex-row-reverse">
					<div class="col-auto ml-lg-auto">
						<div class="row align-items-center">

						</div>
					</div>
					<div class="col-12 col-lg-auto mt-3 mt-lg-0 text-center">
						Copyright Â© 2018
						<a href=".">CAMS Sdn Bhd</a>. Theme by
						<a href="https://tentspark.com" target="_blank">tenstpark</a> All rights reserved.
					</div>
				</div>
			</div>
		</footer>
	</div>




	<script type="text/javascript">
		require(['mainjs', 'twbs', 'modal'], function () {

			//When the page has loaded.
			$(document).ready(function () {

				$("#r_submit").on('click', function () {
					$("#r_submit").hide();
					$("#r_update").hide();
				});

				//get today date
				var today = new Date();
				var dd = String(today.getDate()).padStart(2, '0');
				var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
				var yyyy = today.getFullYear();
				today = mm + '/' + dd + '/' + yyyy;

				var aid = "2Ss9pEcpIDpgA32Phmvj"//temporary
				//aid=sessionStorage.get("aid");
				console.log(uid)
				console.log(aid)

				var db = firebase.firestore()

				//retrieve data from firestore and update the field
				db.collection("Article").doc(aid).collection("reviews").doc(uid).get().then(function (querySnapshot) {
					console.log(querySnapshot.data().Title)
					$("#Title_R").val(querySnapshot.data().Title)

					console.log(querySnapshot.data().Abstract)
					$("#Abstract_R").val(querySnapshot.data().Abstract)

					console.log(querySnapshot.data().Keywords)
					$("#Keywords_R").val(querySnapshot.data().Keywords)

					console.log(querySnapshot.data().Introduction)
					$("#Introduction_R").val(querySnapshot.data().Introduction)

					console.log(querySnapshot.data().Literature_Review)
					$("#Literature_Review_R").val(querySnapshot.data().Literature_Review)

					console.log(querySnapshot.data().Research_Methodology)
					$("#Research_Methodology_R").val(querySnapshot.data().Research_Methodology)

					console.log(querySnapshot.data().Conclusion)
					$("#Conclusion_R").val(querySnapshot.data().Conclusion)

					console.log(querySnapshot.data().Contribution)
					$("#Contribution_R").val(querySnapshot.data().Contribution)

					console.log(querySnapshot.data().References)
					$("#References_R").val(querySnapshot.data().References)

					console.log(querySnapshot.data().Overall)
					$("#Overall_R").val(querySnapshot.data().Overall)

					console.log(querySnapshot.data().NoteEditor)
					$("#NoteEditor_R").val(querySnapshot.data().NoteEditor)

					console.log(querySnapshot.data().Decision)
					$("#Decision_R").val(querySnapshot.data().Decision)
				});


				$("#r_update").click(function (event) {

					var db = firebase.firestore()
					var obj = Object();

					obj.Title = $("#Title_R").val();
					obj.Abstract = $("#Abstract_R").val();
					obj.Keywords = $("#Keywords_R").val();
					obj.Introduction = $("#Introduction_R").val();
					obj.Literature_Review = $("#Literature_Review_R").val();
					obj.Research_Methodology = $("#Research_Methodology_R").val();
					obj.Conclusion = $("#Conclusion_R").val();
					obj.Contribution = $("#Contribution_R").val();
					obj.References = $("#References_R").val();
					obj.Overall = $("#Overall_R").val();
					obj.NoteEditor = $("#NoteEditor_R").val();
					obj.Decision = $("#Decision_R").val();
					obj.Date = today;

					var articleRef = db.collection("Article").doc(aid).collection("reviews").doc(uid)
					//var articleRef = db.collection("Article").doc(aid).collection("reviews").doc(rid)

					//update firestore
					articleRef.update(obj)

					alert("Successful Update");


				});

				$("#r_submit").click(function (event) {

					var db = firebase.firestore()
					var obj = Object();

					obj.Title = $("#Title_R").val();
					obj.Abstract = $("#Abstract_R").val();
					obj.Keywords = $("#Keywords_R").val();
					obj.Introduction = $("#Introduction_R").val();
					obj.Literature_Review = $("#Literature_Review_R").val();
					obj.Research_Methodology = $("#Research_Methodology_R").val();
					obj.Conclusion = $("#Conclusion_R").val();
					obj.Contribution = $("#Contribution_R").val();
					obj.References = $("#References_R").val();
					obj.Overall = $("#Overall_R").val();
					obj.NoteEditor = $("#NoteEditor_R").val();
					obj.Decision = $("#Decision_R").val();
					obj.Date = today;



					var articleRef = db.collection("Article").doc(aid).collection("reviews").doc(uid)
					// articleRef = db.collection("Article").doc(aid).collection("reviews").doc(uid)

					//update firestore
					articleRef.update(obj)

					//update article status to Reviewed
					statusObj = new Object()
					statusObj.status = "Reviewed"
					alert("Submitted");

					db.collection("Users").doc(uid).collection("AssignedArticle").doc(aid).update(statusObj).then(function () {
						console.log("Document successfully updated!");
					}).catch(function (error) {
						console.error("Error", error);
					});


				});


			});




		});



	</script>
</body>

</html>