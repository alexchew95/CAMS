<!doctype html>
<html lang="en" dir="ltr">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta http-equiv="Content-Language" content="en" />
	<meta name="msapplication-TileColor" content="#2d89ef">
	<meta name="theme-color" content="#4188c9">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<link rel="icon" href="./favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
	<!-- Generated: 2018-04-06 16:27:42 +0200 -->
	<title>CAMS - Home</title>
	<script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-firestore.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,500,500i,600,600i,700,700i&amp;subset=latin-ext">
	<script src="./assets/js/require.min.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"
		integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous">
		</script>
	<script src="./assets/js/dynamic-form.js"></script>

	<script>
		requirejs.config({
			baseUrl: '.'
		});

	</script>

	<link href="./assets/css/dashboard.css" rel="stylesheet" />
	<script src="./assets/js/dashboard.js"></script>
	<script src="./assets/plugins/input-mask/plugin.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

</head>
<div class="custom-loader"></div>

<body class="">
	<div class="page">
		<div class="page-main">
			<div class="header py-4">
				<div class="container" id="topbar">
					<!--Header to auto load here-->
				</div>
			</div>

			<div class="header collapse d-lg-flex p-0" id="headerMenuCollapse">
				<div class="container" id="navbar">

				</div>
			</div>

			<div class="my-3 my-md-5">
				<div class="container">
					<div class="page-header">
						<h1 class="page-title">
							New Journal Submission
						</h1>
					</div>


					<fieldset class="form-fieldset" id="add_Journal_Info">
						<form id="Add_Journal_Info">
							<div class="form-group">
								<label class="form-label">Artical Type:<span class="form-required">*</span></label>
								<input type="text" id="ArticleType" class="form-control" />
							</div>
							<div class="form-group">
								<label class="custom-file">Main Subject Area of Artical:<span
										class="form-required">*</span></label>
								<!-- <input type="text" id="Area" class="form-control" /> -->
								<select name="AreaOfInterest" id="Area">
									<option value="Algorithms">Algorithms</option>
									<option value="Artificial Intelligence">Artificial Intelligence</option>
									<option value="Circular Economy">Circular Economy</option>
									<option value="Computer Vision">Computer Vision</option>
									<option value="E-Commerce">E-Commerce</option>
									<option value="Hospitality, Travel, and Tourism Management">Hospitality, Travel, and
										Tourism Management</option>
									<option value="Intelligent Automation">Intelligent Automation</option>
									<option value="Marketing">Marketing</option>
									<option value="Mobile Apps">Mobile Apps</option>
									<option value="Mobile Payment Systems">Mobile Payment Systems</option>
									<option value="Sensor Technology">Sensor Technology</option>
									<option value="Virtual Reality">Virtual Reality</option>
									<option value="Web Technologies">Web Technologies</option>
								</select>
							</div>
							<div class="form-group">
								<label class="form-label">Full Title of Journal:<span
										class="form-required">*</span></label>
								<input type="text" id="title" class="form-control" />
							</div>
							<div class="form-group">
								<div class="row">
									<div class="col-md-5">
										<label class="form-label">Author:<span class="form-required">*</span></label>
										<input type="text" id="CA_Name" class="form-control" placeholder="Disabled.."
											disabled />
									</div>
									<div class="col-md-5">
										<label class="form-label">Email:<span class="form-required">*</span></label>
										<input type="text" class="form-control" id="email" placeholder="Disabled.."
											disabled>
									</div>
								</div>
							</div>

							<form id="CA">
								<div class="row" id="dynamic_form">
									<div class="col-md-5">
										<label class="form-label">Corresponding Author(s):<span
												class="form-required">*</span></label>
										<input type="text" id = "C_Name" class="form-control" placeholder="Author" />
									</div>
									<div class="col-md-5">
										<label class="form-label">Email:<span class="form-required">*</span></label>
										<input type="text" id = "C_Email" class="form-control" placeholder="Email">

									</div>
									<div class="btn-list">
										<label class="form-label"><span style="opacity: 0 ;">This is
												transparent</span></label>
										<a href="javascript:void(0)" class="btn btn-primary" id="plus5" onclick="add_element_to_array();">Add More</a>
										<a href="javascript:void(0)" class="btn btn-danger" id="minus5">Remove</a>
									</div>
								</div>
								<br />
								<!-- <button id="test" type="submit" class="btn btn-primary">Submit</button> -->
							</form>


							<div class="form-group mb-0">
								<label class="form-label">Abstract:<span class="form-required">*</span></label>
								<input type="text" id="Abstract" class="form-control" />
							</div>
							<div class="form-group">
								<label class="form-label">Keywords:<span class="form-required">*</span></label>
								<input type="text" id="Keywords" class="form-control" />
							</div>

							<!-- <div class="form-group">
									<a href="FILEUPLOADindex.html">
									<button>Upload Article</button>
							</div> -->
							<div class="btn-list">
								<a href="#" id="add" class="btn btn-success" type="submit">Save changes</a>
								<button href='#'  class="btn btn-danger">Back</button>
								<button style="display: none;" id = "upload" type="button" class="btn btn-dark"><a href="FILEUPLOADindex.html" /><i
										class="fe fe-upload mr-2"></i>Upload</button>
							</div>

							<!-- <div class="form-group">
									<div class="custom-file">
									  <input type="file" class="custom-file-input" name="example-file-input-custom">
									  <label class="custom-file-label">Choose file</label>
									  <!-- <button type="button" class="btn btn-dark"><i class="fe fe-upload mr-2"></i>Upload</button> -->
				</div>
			</div> -->

			<br />
			<br />
			<!-- <div class="btn-list">
								<a href="#" id="add" class="btn btn-success" type="submit">Save changes</a>
								<button href='#' onclick="window.history.back()" class="btn btn-danger">Back</button>
								<button href="FILEUPLOADindex.html" type="button" class="btn btn-dark"><i class="fe fe-upload mr-2"></i>Upload</button>
							</div> -->


			</form>


			</fieldset>
		</div>

	</div>



	</div>
	<div class="footer">

	</div>
	<footer class="footer">
		<div class="container">
			<div class="row align-items-center flex-row-reverse">
				<div class="col-auto ml-lg-auto">
					<div class="row align-items-center">

					</div>
				</div>
				<div class="col-12 col-lg-auto mt-3 mt-lg-0 text-center">
					Copyright Â© 2018
					<a href=".">CAMS Sdn Bhd</a>. Theme by
					<a href="https://tentspark.com" target="_blank">tenstpark</a> All rights reserved.
				</div>
			</div>
		</div>
	</footer>
	</div>



	<script>
		var dynamic_form = $("#dynamic_form").dynamicForm("#dynamic_form", "#plus5", "#minus5", {
			limit: 5,
			formPrefix: "dynamic_form",
			normalizeFullForm: false
		});

		//dynamic_form.inject([{CA_Name: username,email: email}]);
		document.getElementById('CA_Name').value = sessionStorage.getItem("name");
		document.getElementById('email').value = sessionStorage.getItem("email");

		$("#dynamic_form #minus5").on('click', function () {
			var initDynamicId = $(this).closest('#dynamic_form').parent().find("[id^='dynamic_form']").length;
			if (initDynamicId == 1) {
				$(this).closest('#dynamic_form').next().find('#minus5').hide();
			}
			$(this).closest('#dynamic_form').remove();
		});

		 x = 0;
		var id = 0;
		var array = Array();
		var array1 = Array();
		function add_element_to_array()
			{
				array[x] = document.getElementById("C_Name"+id).value;
				array1[x] = document.getElementById("C_Email"+id).value;	
				x++;
				id++;
				console.log(array)
				console.log(array1)
			}

	</script>


	<script type="text/javascript">
		require(['mainjs', 'twbs', 'modal'], function () {

			//When the page has loaded.
			$(document).ready(function () {

				$("#add").on('click', function () {
            $("#upload").show();
        });

				var today = new Date();
				var dd = String(today.getDate()).padStart(2, '0');
				var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
				var yyyy = today.getFullYear();
				var aid;
				today = mm + '/' + dd + '/' + yyyy;

				//get uid from sessionStorage
				var username = sessionStorage.getItem("uid");

				$("#test").click(function (event) {
					var values = {};
					$.each($('form').serializeArray(), function (i, field) {
						console.log(field)

						//values[field.name] = field.value;
					});
					event.preventDefault();
				});


				$("#add").click(function (event) {

					var article1 = $("#ArticleType").val();//get content from textbox
					var area1 = $("#Area").val();//get content from textbox
					var title1 = $("#title").val();//get content from textbox
					var abstract1 = $("#Abstract").val();//get content from textbox
					var keywords = $("#Keywords").val();//get content from textbox
					var CA = $('#CA_Name').val();
					var CoverURL = "";
					var MergeURL = ""; 
					var status = "Pending"
					//var aid = "";
					var obj = new Object();//create table
					

					//obj.aid = aid;
					obj.article = article1;//assign value to column
					obj.CA = CA;
					obj.Status = status;
					obj.entryDate = today;
					obj.reviewStatus = 'false';
					obj.status = 'pending';
					obj.title = title1;//assign value to column 
					obj.area = area1;//assign value to column
					obj.abstract = abstract1;//assign value to column
					obj.keywords = keywords;//assign value to column
					obj.uid = username;
					obj.CoverURL = CoverURL;
					obj.MergeURL = MergeURL;
					//obj.CreatedDateTime = firebase.firestore.FieldValue.serverTimestamp();//assign value to CreatedDateTime  column 

					var db = firebase.firestore()
					db.collection("Article").add(obj)
						.then(function (docRef) {
							console.log(docRef.id)
							db.collection("Article").doc(docRef.id).update({
								aid : docRef.id
								
								
							})
							console.log(x)
							//run array add based on x size
							for(a=0;a<=x;a++)
							{
								var authorsObj = new Object();
								authorsObj.name = document.getElementById("C_Name"+a).value;
								authorsObj.email = document.getElementById("C_Email"+a).value;
console.log(authorsObj.name)
								db.collection("Article").doc(docRef.id).collection("authors").add(authorsObj)
							}
							//db.collection("Article").doc(docRef.id).collection("authors").add(array)

						/* 	db.collection("Article").doc(docRef.id).set({ aid: docRef.id }, obj.assign({})).then(function (doc) {
								console
							})
							console.error("Done "); */
							sessionStorage.setItem("aid", docRef.id);

						})
						.catch(function (error) {

							console.error("Error writing document: ", error);
							console.error("Done x ");
						});

						
						// sessionStorage.setItem("aid", docRef.id);
				});


			});




		});



	</script>
</body>

</html>